name: Ultra Simple Telegram

on: [push]

jobs:
  simple-telegram:
    runs-on: self-hosted
    
    steps:
    - name: Test 1 - Check token
      shell: powershell
      run: |
        $token = "${{ secrets.TELEGRAM_BOT_TOKEN }}"
        if ($token) {
            Write-Host "✅ Token mavjud, uzunligi: $($token.Length)"
        } else {
            Write-Host "❌ Token mavjud emas!"
        }
    
    - name: Test 2 - Simple Telegram API call
      shell: powershell
      run: |
        try {
            $token = "${{ secrets.TELEGRAM_BOT_TOKEN }}"
            $url = "https://api.telegram.org/bot$token/getMe"
            Write-Host "URL: $url"
            
            $response = Invoke-RestMethod -Uri $url -Method Get
            Write-Host "Bot info: $($response | ConvertTo-Json)"
        }
        catch {
            Write-Host "Error: $($_.Exception.Message)"
            Write-Host "Error details: $($_.Exception)"
        }
      continue-on-error: true
        
    - name: Test 3 - Get updates
      shell: powershell  
      run: |
        try {
            $token = "${{ secrets.TELEGRAM_BOT_TOKEN }}"
            $url = "https://api.telegram.org/bot$token/getUpdates"
            
            $updates = Invoke-RestMethod -Uri $url -Method Get
            Write-Host "Updates count: $($updates.result.Count)"
            
            if ($updates.result.Count -gt 0) {
                Write-Host "First update: $($updates.result[0] | ConvertTo-Json)"
            }
        }
        catch {
            Write-Host "Error getting updates: $($_.Exception.Message)"
        }
      continue-on-error: true
